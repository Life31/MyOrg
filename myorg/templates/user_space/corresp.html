{% load static %}
{% load user_filters %}
{% if user_widgets.corr %}
<div class="card" id="3" style="display: flex; width: 49px; height: 54px; overflow: hidden;">
{% else %}<div class="card" id="3" style="display: none;">
{% endif %}
	<div class="title" onmouseover="titleonmouseover(this)" onmouseout="titleonmouseout(this)">

		<div class="off corr widget_place_for_image" {% if user_widgets.corr_open %}name="open"{% else %}name="close"{% endif %}>
			<img 
				class="img_for_btn top_left_screen"
				onclick="closeOpenCard(this)"
				style="margin: 10px; width: 80%; height: 80%;"
				title="свернуть / развернуть виджет"
				src={% static "corresp.png" %}
			>
		</div>
		<div style="width:70%; display: none;">
			<a style="color: rgb(102, 168, 243); text-decoration: none; font-size: 24px;"
				title="Перейти на полную версию"
				href="{% url 'all_corresp' %}">
				Корреспонденция
			</a>
		</div>
		<div style="width: 10%; display: none; margin-left: 15px;">
			<a style="display: none;" href="{% url 'user_widget_delete' user.id 'corr' %}">
				<img style="height: 90%; width: 90%;" title="удалить виджет" src={% static "denay.png" %}>
			</a>
		</div>
	</div>
	<div class="widget_data">
		<div style="display: flex; flex-direction: row; justify-content: center; align-items: center; margin-top: 0px;">
			<div class="prev-b-cor task part" style="width: 20px; line-height: 20px; cursor: pointer; display: flex; flex-direction: row; justify-content: center; align-items: center;" aria-label="Предыдущий">&lt;</div>
			<div class="cur_b_cor task part" style="width: 240px; display: flex; flex-direction: row; justify-content: center; align-items: center;">СЗ</div>
			<div class="next-b-cor task part" style="width: 20px; line-height: 20px; cursor: pointer; display: flex; flex-direction: row; justify-content: center; align-items: center;" aria-label="Следующий">&gt;</div>
		</div>
		<div class="slider_c-container" style="margin: 1px; display: flex; flex-direction: column; justify-content: top; align-items: center; width: 100%; height: 90%;">
			<div class="slider_c" style="display: flex; flex-direction: column; justify-content: top; align-items: center; width: 100%; height: 100%; transition: 0.5s ease-in-out;">
				<div class="slider_c-slide" style="width: 100%; height: 100%;">
					<div style="overflow-y: scroll; display: flex; flex-direction: column; justify-content: top; align-items: center; margin-bottom: 1px; height: 100%; width: 100%;">
						{% for cor in corresp %}
							{% if cor.cor_type_id == 1 %}
								<div class="task docs text_a" dir={{cor.in_out_id}} year="{{cor.day.year}}" tag="{{cor.tag}}"
								style="{% if cor.in_out_id == 1 and cor.day.year == year %}display: flex;{% else %}display: none;{% endif %} flex-direction: row; justify-content: left; align-items: center; width: 95%;">
									<a style="color: black; width: 25%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">{{cor.day|date:"d.m.Y"}}</a>
									{% if cor.file.url != None %}
									<a style="color: blue; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px;" href="{{ cor.file.url }}">№{{cor.number}}</a>
									{% else %}
									<a style="color: black; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">№{{cor.number}}</a>
									{% endif %}
									<a style="color: black; width: 50%; font-size: 12px; margin: 1px; text-decoration: none; cursor: default;" href="#" title="{{cor.comment}} {{cor.tag}}">{{cor.comment|substring}}</a>
								</div>
							{% endif%}
						{% endfor %}
					</div>
				</div>
				<div class="slider_c-slide" style="width: 100%; height: 100%;">
					<div style="overflow-y: scroll; display: flex; flex-direction: column; justify-content: top; align-items: center; margin-bottom: 1px; height: 100%; width: 100%;">
						{% for cor in corresp %}
							{% if cor.cor_type_id == 2 %}
								<div class="task docs text_a" dir={{cor.in_out_id}} year="{{cor.day.year}}" tag="{{cor.tag}}"
								style="{% if cor.in_out_id == 1 and cor.day.year == year %}display: flex;{% else %}display: none;{% endif %} flex-direction: row; justify-content: left; align-items: center; width: 95%;">
									<a style="color: black; width: 25%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">{{cor.day|date:"d.m.Y"}}</a>
									{% if cor.file.url != None %}
									<a style="color: blue; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px;" href="{{ cor.file.url }}">№{{cor.number}}</a>
									{% else %}
									<a style="color: black; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">№{{cor.number}}</a>
									{% endif %}
									<a style="color: black; width: 50%; font-size: 12px; margin: 1px; text-decoration: none; cursor: default;" href="#" title="{{cor.comment}} {{cor.tag}}">{{cor.comment|substring}}</a>
								</div>
							{% endif%}
						{% endfor %}
					</div>
				</div>
				<div class="slider_c-slide" style="width: 100%; height: 100%;">
					<div style="overflow-y: scroll; display: flex; flex-direction: column; justify-content: top; align-items: center; margin-bottom: 1px; height: 100%; width: 100%;">
						{% for cor in corresp %}
							{% if cor.cor_type_id == 3 %}
								<div class="task docs text_a" dir={{cor.in_out_id}} year="{{cor.day.year}}" tag="{{cor.tag}}"
								style="{% if cor.in_out_id == 1 and cor.day.year == year %}display: flex;{% else %}display: none;{% endif %} flex-direction: row; justify-content: left; align-items: center; width: 95%;">
									<a style="color: black; width: 25%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">{{cor.day|date:"d.m.Y"}}</a>
									{% if cor.file.url != None %}
									<a style="color: blue; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px;" href="{{ cor.file.url }}">№{{cor.number}}</a>
									{% else %}
									<a style="color: black; width: 35%; font-size: 12px; border-right: 1px solid black; margin: 2px; text-decoration: none; cursor: default;" href="#">№{{cor.number}}</a>
									{% endif %}
									<a style="color: black; width: 50%; font-size: 12px; margin: 1px; text-decoration: none; cursor: default;" href="#" title="{{cor.comment}} {{cor.tag}}">{{cor.comment|substring}}</a>
								</div>
							{% endif%}
						{% endfor %}
					</div>
				</div>

			</div>
		</div>
	</div>
	<div class="widget_footer">
		<a class="btn widg_f_btn btn_in" id="btn_in_out" style="width: 33%; border-radius: 8px 8px 8px 18px;" href="#" onclick="btnInOutClick(this)">
			<span style="color:rgb(102, 168, 243)">Вх.</span>
			&nbsp;/&nbsp;
			<span>Исх.</span>
		</a>
		<a class="btn widg_f_btn year_cor" style="width: 34%; border-radius: 8px 8px 8px 8px; color: rgb(102, 168, 243);" href="#" onclick="openYearBtns()">{{year}}</a>
		<div id="year_btns" style="display: none; flex-direction: column;position: absolute; left: 114px; bottom: 35px; height: 100px; overflow-y: scroll;">
			{% for c_y in cor_years %}
				<a class="btn widg_f_btn" style="width: 115px; border-radius: 8px 8px 8px 8px;" href="#" onclick="btnYearClick(this)">{{c_y}}</a>
			{% endfor %}
		</div>

		
		
		<a class="btn widg_f_btn" id="tag_btn" style="width: 33%; border-radius: 8px 8px 18px 8px; color: rgb(102, 168, 243);" href="#" title="Тег" onclick="openTagsBtns()">Все</a>
		<div id="tags_btns" style="display: none; flex-direction: column;position: absolute; left: 229px; bottom: 35px; height: 100px; overflow-y: scroll;">
			<a class="btn widg_f_btn" style="width: 113px; border-radius: 8px 8px 8px 8px;" href="#" onclick="btnTagClick(this)">Все</a>
			{% for c_t in cor_tags %}
				<a class="btn widg_f_btn" style="width: 113px; border-radius: 8px 8px 8px 8px;" href="#" onclick="btnTagClick(this)">{{c_t}}</a>
			{% endfor %}
		</div>
	</div>	
</div>
<script>
	const slider_c = document.querySelector('.slider_c');
	const prevButton_c = document.querySelector('.prev-b-cor');
	const nextButton_c = document.querySelector('.next-b-cor');
	const cur_b_cor = document.querySelector('.cur_b_cor')
	const slides_c = Array.from(slider_c.querySelectorAll('.slider_c-slide'));
	const slideCount_c = slides_c.length;
	let slideIndex_c = 0;
	// Устанавливаем обработчики событий для кнопок
	prevButton_c.addEventListener('click', showPreviousSlide_c);
	nextButton_c.addEventListener('click', showNextSlide_c);
	// Функция для показа предыдущего слайда
	function showPreviousSlide_c() {
		slideIndex_c = (slideIndex_c - 1 + slideCount_c) % slideCount_c;
		updateSlider_c();
	}
	// Функция для показа следующего слайда
	function showNextSlide_c() {
		slideIndex_c = (slideIndex_c + 1) % slideCount_c;
		updateSlider_c();
	}
	// Функция для обновления отображения слайдера
	function updateSlider_c() {
		slides_c.forEach((slide, index) => {
			if (index === slideIndex_c) {
				slide.style.display = 'block';
			} else {
				slide.style.display = 'none';
			}
		});
		
		if (slideIndex_c === 0) {
			cur_b_cor.textContent = "СЗ";
		} else if (slideIndex_c === 1) {

			cur_b_cor.textContent = "Письма";
		} else if (slideIndex_c === 2) {

			cur_b_cor.textContent = "Меморандумы";
		}
	}
	// Инициализация слайдера
	updateSlider_c();

	let all_cor = document.querySelectorAll('.docs');
	let year_for_docs = document.querySelector('.year_cor');
	let btn_in_out = document.getElementById('btn_in_out');
	let year_btns = document.getElementById('year_btns');
	let tags_btns = document.getElementById('tags_btns');
	let tag_btn = document.getElementById('tag_btn');

	function btnInOutClick(obj) {
		if (obj.classList.contains('btn_in')) {		
			obj.classList.replace('btn_in', 'btn_out');
			obj.childNodes[3].style.color = "rgb(102, 168, 243)";
			obj.childNodes[1].style.color = "black";

			all_cor.forEach((doc) => {
				if(doc.getAttribute('dir') == 1) {
					doc.style.display = 'none';
				} else {
					if ( tag_btn.textContent == 'Все') {
						checkYear(doc);
					}else if (doc.getAttribute('tag') == tag_btn.textContent) {
						checkYear(doc);
					} else {
						doc.style.display = 'none';
					}
				}
			});
		} else {
			obj.classList.replace('btn_out', 'btn_in');
			obj.childNodes[1].style.color = "rgb(102, 168, 243)";
			obj.childNodes[3].style.color = "black";

			all_cor.forEach((doc) => {
				if(doc.getAttribute('dir') == 2) {
						doc.style.display = 'none';
						
				} else {
					if ( tag_btn.textContent == 'Все') {
						checkYear(doc);
					}else if (doc.getAttribute('tag') == tag_btn.textContent) {
						checkYear(doc);
					} else {
						doc.style.display = 'none';
					}
				}
			});
		}
	}
	function checkYear(doc) {
		if (doc.getAttribute('year') == year_for_docs.textContent) {
			doc.style.display = 'flex';
		} else {
			doc.style.display = 'none';
		}
	}
	function btnYearClick(obj) {
		year_for_docs.textContent = obj.textContent;
		all_cor.forEach((doc) => {
			if (doc.getAttribute('year') != obj.textContent) {
				doc.style.display = 'none';
				
			} else {
				
				if (btn_in_out.classList.contains('btn_in')) {
					if(doc.getAttribute('dir') == 1) {
						checkTag(doc);
					}else {
						doc.style.display = 'none';
					}
				} else {
					if(doc.getAttribute('dir') == 2) {
						checkTag(doc);
					}else {
						doc.style.display = 'none';
					}
				}
			}
		});
		year_btns.style.display = 'none';
	}
	function openYearBtns() {
		if (year_btns.style.display == 'none') {
			year_btns.style.display = 'flex';
		} else {
			year_btns.style.display = 'none';
		}
		
	}
	function openTagsBtns() {
		if (tags_btns.style.display == 'none') {
			tags_btns.style.display = 'flex';
		} else {
			tags_btns.style.display = 'none';
		}
	}
	function btnTagClick(obj) {
		tag_btn.textContent = obj.textContent;
		all_cor.forEach((doc) => {
			if ( tag_btn.textContent == 'Все') {
				if (btn_in_out.classList.contains('btn_in')) {
					if(doc.getAttribute('dir') == 1) {
						checkYear(doc);
						
					}else {
						doc.style.display = 'none';
					}
				} else {
					if(doc.getAttribute('dir') == 2) {
						checkYear(doc);
						
					}else {
						doc.style.display = 'none';
					}
				}
			}
			else if (doc.getAttribute('tag') != obj.textContent) {
				doc.style.display = 'none';
				
			} else {
				
				if (btn_in_out.classList.contains('btn_in')) {
					if(doc.getAttribute('dir') == 1) {
						checkYear(doc);
						
					}else {
						doc.style.display = 'none';
					}
				} else {
					if(doc.getAttribute('dir') == 2) {
						checkYear(doc);
						
					}else {
						doc.style.display = 'none';
					}
				}
			}
		});
		tags_btns.style.display = 'none';
	}
	function checkTag(doc) {
		if ( tag_btn.textContent == 'Все') {
			doc.style.display = 'flex';
		}else if (doc.getAttribute('tag') == tag_btn.textContent) {
			doc.style.display = 'flex';
		} else {
			doc.style.display = 'none';
		}
	}
</script>